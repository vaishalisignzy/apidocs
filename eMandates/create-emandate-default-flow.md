# Create eMandate: Default Flow

## Introduction

The Auth Link received in the response will be redirected to a link. Once the authorization is complete, your customer will be redirected to Signzy URL. Store the subReferenceId as this is the unique id generated by Signzy for the subscription and will be required for subsequent operations.

## API Use-case

The purpose is to create an e-mandate

How to use the API
------------------

The users need to give inputs as per the input guidelines below. Same end-point can be used to access either of the flows (CUSTOM and DEFAULT) by changing the variable "emandateFlow" value.

## API Input Guidelines

* Pass a valid JSON body
* Pass a valid Authorization Key in headers

## Input parameters & Sample cURL request

{% tabs %}
{% tab title="Input Parameters" %}


| Parameter Name       | Description                                                                                                                                                                                                                             | Required/Optional                |   |   |
| -------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------- | - | - |
| customerName         | contains the essential input data                                                                                                                                                                                                       | Optional                         |   |   |
| customerEmail        | contains the image url                                                                                                                                                                                                                  | Required                         |   |   |
| customerPhone        | contains the fields it matches data from.                                                                                                                                                                                               | Required                         |   |   |
| mandateType          | Accepted values are PERIODIC or ON\_DEMAND. PERIODIC - Payments are triggered automatically at fixed intervals defined by the merchant. ON\_DEMAND - Merchant needs to trigger/charge the customer explicitly with the required amount. | Required                         |   |   |
| mandateFlow          | Type of flow. Accepted values are CUSTOM or DEFAULT. If left blank, default flow will be used.                                                                                                                                          | Optional                         |   |   |
| maxCycles            | Maximum number of debits set for the plan. The subscription will automatically change to COMPLETED status once this limit is reached. Default value is infinity.                                                                        | Optional                         |   |   |
| description          | A brief note about the eMandate                                                                                                                                                                                                         | Optional                         |   |   |
| notificationChannels | List containing possible values: EMAIL, SMS. The checkout link is sent through the given notification channels.                                                                                                                         | Optional                         |   |   |
| expiresOn            | (Date,pattern :yyyy-MM-dd HH:mm:ss) The last date till which the eMandate stands valid. After this date, the status of eMandate will be changed to COMPLETED. Default value is 2 years from date of eMandate creation.                  | Optional                         |   |   |
| authAmount           | (Decimal upto 2 precision) This is the amount that will be charged to authenticate the payment and is applicable for UPI and Cards only. The default amount is Re. 1/-. Note: This amount is not refunded to the customer.              | Optional                         |   |   |
| firstChargeDate      | (Date,pattern :yyyy-MM-dd) This will be the date at which the first payment takes place. Applicable for Periodic eMandate only.  Minimum can only be 2 days later from today's date.                                                    | Required for PERIODIC eMandate   |   |   |
| intervalType         | The type of interval for a PERIODIC plan. Accepted values are DAY, WEEK, MONTH, YEAR. This is a conditional parameter. Not applicable for on-demand eMandates.                                                                          | Required for PERIODIC eMandate   |   |   |
| intervals            | Number of intervals of intervalType between every subscription payment. For example, to charge a customer bi-weekly use intervalType as “week” and intervals as 2. Default value is 1. Not applicable for on-demand plans.              | Optional for PERIODIC plan.      |   |   |
| amount               | The amount to be charged for PERIODIC plan. Not applicable for on-demand plans.                                                                                                                                                         | Required for PERIODIC plan.      |   |   |
| maxAmount            | The maximum amount to be charged for ON\_DEMAND plan. This is a conditional parameter. Not applicable for periodic plans.                                                                                                               | Required for ON\_DEMAND eMandate |   |   |
| callbackUrl          | URL to which eMandate status change and authentication status change will be posted                                                                                                                                                     | Optional                         |   |   |


{% endtab %}

{% tab title="Sample cURL request" %}
```
curl --location --request POST 'https://api.signzy.app/api/v3/eNach/eMandates' \
--header 'Authorization: ...key...' \
--header 'Content-Type: application/json' \
--data-raw '{
    "customerName": "..customerName..",
    "customerEmail": "..customerEmail..",
    "customerPhone": "..customerPhone..",
    "mandateType": "..ON_DEMAND/PERIODIC..",
    "mandateFlow": "..DEFAULT/CUSTOM..",
    "maxCycles":1,
    "description":"..description..",
    "expiresOn":"YYYY-MM-DD HH:mm:ss",
    "authAmount":1,
    "firstChargeDate": "YYYY-MM-DD",
    "intervalType": "..DAY/WEEK/MONTH/YEAR",
    "maxAmount": 100,
    "notificationChannels": ["EMAIL","SMS"]
}'
```


{% endtab %}
{% endtabs %}

## Output Parameters and Sample API response

{% tabs %}
{% tab title="Output Parameters" %}
| Parameter Name        | Description                                                                                                                                                              |
| --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| result.status         | eMandate creation status                                                                                                                                                 |
| result.message        | eMandate creation message                                                                                                                                                |
| result.subReferenceId | A unique ID generated for eMandates. This will be used to identify eMandates.                                                                                            |
| result.authLink       | Authorization link. In case of DEFAULT flow, it will redirect to website for filling in payment details. For CUSTOM flow, it will redirect directly to the consent link. |
| result.subStatus      | eMandate status                                                                                                                                                          |


{% endtab %}

{% tab title="Sample API Response" %}
```
{
  "status": "OK",
  "message": "Subscription created successfully",
  "subReferenceId": 9999999,
  "authLink": "https://cfre.in/abcd",
  "subStatus": "INITIALIZED"
}
```
{% endtab %}
{% endtabs %}

## HTTP Response codes&#x20;

| Status code | Description                     |
| ----------- | ------------------------------- |
| **200**     | All response details are valid  |
| **404**     | Not found                       |
| **400**     | Bad Request                     |
| **401**     | Unauthorized                    |
| **403**     | Forbidden                       |
| **422**     | Unprocessable entity            |



{% swagger baseUrl="https://api.signzy.app" path="/api/v3/eNach/eMandates" method="post" summary="Create eMandate Custom Flow" %}
{% swagger-description %}
This method creates a new eMandate
{% endswagger-description %}

{% swagger-parameter in="body" name="customerName" type="" required="false" %}

{% endswagger-parameter %}

{% swagger-parameter in="body" name="customerEmail" type="" required="true" %}

{% endswagger-parameter %}

{% swagger-parameter in="body" name="customerPhone" required="true" type="" %}

{% endswagger-parameter %}

{% swagger-parameter in="body" name="mandateName" %}

{% endswagger-parameter %}

{% swagger-parameter in="body" name="mandateType" required="true" %}

{% endswagger-parameter %}

{% swagger-parameter in="body" name="mandateFlow" %}

{% endswagger-parameter %}

{% swagger-parameter in="body" name="maxCycles" %}

{% endswagger-parameter %}

{% swagger-parameter in="body" name="description" %}

{% endswagger-parameter %}

{% swagger-parameter in="body" name="notificationChannels" type="List" %}

{% endswagger-parameter %}

{% swagger-parameter in="body" name="returnUrl" %}

{% endswagger-parameter %}

{% swagger-parameter in="body" name="expiresOn" %}

{% endswagger-parameter %}

{% swagger-parameter in="body" name="authAmount" %}

{% endswagger-parameter %}

{% swagger-parameter in="body" name="amount" %}

{% endswagger-parameter %}

{% swagger-parameter in="body" name="intervalType" %}

{% endswagger-parameter %}

{% swagger-parameter in="body" name="intervals" %}

{% endswagger-parameter %}

{% swagger-parameter in="body" name="firstChargeDate" %}

{% endswagger-parameter %}

{% swagger-parameter in="body" name="maxAmount" %}

{% endswagger-parameter %}

{% swagger-response status="200" description="Successful eMandate creation" %}
```
{
    "result": {
        "status": "OK",
        "message": "..message..",
        "subReferenceId": ..subReferenceId..,
        "authLink": "..authLink..",
        "subStatus": "..eMandateStatus.."
    }
}
```
{% endswagger-response %}
{% endswagger %}

|   |
| - |

